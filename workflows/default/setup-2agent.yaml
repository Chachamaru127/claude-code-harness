# /setup-2agent ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼å®šç¾©
# 2ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆä½“åˆ¶ï¼ˆCursor PM + Claude Code Workerï¼‰ã®ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—

phase: setup-2agent
description: "2ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆä½“åˆ¶ã«å¿…è¦ãªãƒ•ã‚¡ã‚¤ãƒ«ã‚’ç”Ÿæˆãƒ»é…ç½®ã™ã‚‹"

steps:
  # Step 1: ç¾åœ¨ã®çŠ¶æ…‹ã‚’ç¢ºèª
  - id: check-setup-status
    skill: ccp-core-read-repo-context
    input:
      files:
        - .cursor-cc-version
        - AGENTS.md
        - CLAUDE.md
        - Plans.md
        - .cursor/commands/assign-to-cc.md
        - .cursor/commands/review-cc-work.md
      context_from:
        - repo_tree
        - plugin_version
    output:
      variables:
        - setup_status  # new | current | outdated
        - existing_files
        - plugin_version
    mode: required

  # Step 2: ãƒãƒ¼ã‚¸ãƒ§ãƒ³æ¯”è¼ƒã¨ç¢ºèª
  - id: version-check
    skill: ccp-setup-2agent-files
    input:
      files:
        - .cursor-cc-version
      variables:
        - setup_status
        - plugin_version
    output:
      variables:
        - should_proceed
        - update_type  # new | update | skip
        - current_version  # æ—¢å­˜ã®ãƒãƒ¼ã‚¸ãƒ§ãƒ³ï¼ˆæ›´æ–°æ™‚ã®ã¿ï¼‰
    mode: required

  # Step 3: ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼ãƒ•ã‚¡ã‚¤ãƒ«ç”Ÿæˆ (AGENTS.md, CLAUDE.md, Plans.md)
  - id: generate-workflow-files
    skill: ccp-generate-workflow-files
    condition: "should_proceed"
    input:
      templates:
        - templates/AGENTS.md.template
        - templates/CLAUDE.md.template
        - templates/Plans.md.template
      variables:
        - project_name
        - date
    output:
      create_files:
        - AGENTS.md
        - CLAUDE.md
        - Plans.md
    mode: required

  # Step 4: Cursorã‚³ãƒãƒ³ãƒ‰ãƒ»ãƒ¡ãƒ¢ãƒªæ§‹é€ ãƒ»ãƒãƒ¼ã‚¸ãƒ§ãƒ³ãƒ•ã‚¡ã‚¤ãƒ«ã®é…ç½®
  - id: setup-2agent-files
    skill: ccp-setup-2agent-files
    condition: "should_proceed"
    input:
      templates:
        - templates/cursor/commands/assign-to-cc.md
        - templates/cursor/commands/review-cc-work.md
        - templates/.cursor-cc-version.template
      variables:
        - plugin_version
        - date
        - project_name
    output:
      create_files:
        - .cursor/commands/assign-to-cc.md
        - .cursor/commands/review-cc-work.md
        - .claude/memory/session-log.md
        - .claude/memory/decisions.md
        - .claude/memory/patterns.md
        - .cursor-cc-version
    mode: required

# æˆåŠŸæ™‚ã®å‡ºåŠ›
on_success:
  message: |
    âœ… **2ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆä½“åˆ¶ã®ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—ãŒå®Œäº†ã—ã¾ã—ãŸï¼** (v{{plugin_version}})

    ğŸ“ **ç”Ÿæˆã•ã‚ŒãŸãƒ•ã‚¡ã‚¤ãƒ«**:
    ```
    ./
    â”œâ”€â”€ AGENTS.md              # é–‹ç™ºãƒ•ãƒ­ãƒ¼æ¦‚è¦
    â”œâ”€â”€ CLAUDE.md              # Claude Code å°‚ç”¨è¨­å®š
    â”œâ”€â”€ Plans.md               # ã‚¿ã‚¹ã‚¯ç®¡ç†ï¼ˆå…±æœ‰ï¼‰
    â”œâ”€â”€ .cursor-cc-version     # ãƒãƒ¼ã‚¸ãƒ§ãƒ³ç®¡ç†
    â”œâ”€â”€ .cursor/
    â”‚   â””â”€â”€ commands/
    â”‚       â”œâ”€â”€ assign-to-cc.md      # ã‚¿ã‚¹ã‚¯ä¾é ¼ã‚³ãƒãƒ³ãƒ‰
    â”‚       â””â”€â”€ review-cc-work.md    # å®Œäº†ãƒ¬ãƒ“ãƒ¥ãƒ¼ã‚³ãƒãƒ³ãƒ‰
    â””â”€â”€ .claude/
        â””â”€â”€ memory/
            â”œâ”€â”€ session-log.md
            â”œâ”€â”€ decisions.md
            â””â”€â”€ patterns.md
    ```

    ---

    ğŸš€ **æ¬¡ã®ã‚¹ãƒ†ãƒƒãƒ—**:

    | ã‚„ã‚ŠãŸã„ã“ã¨ | ã©ã“ã§ | ã‚³ãƒãƒ³ãƒ‰/ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ |
    |-------------|--------|-------------------|
    | æ–°è¦ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆä½œæˆ | Claude Code | `/init` |
    | ã‚¿ã‚¹ã‚¯ã‚’ä¾é ¼ | Cursor | `/assign-to-cc` |
    | å®Ÿè£…é–‹å§‹ | Claude Code | `/start-task` |
    | å®Œäº†å ±å‘Š | Claude Code | `/handoff-to-cursor` |
    | ãƒ¬ãƒ“ãƒ¥ãƒ¼ | Cursor | `/review-cc-work` |

    ğŸ’¡ å›°ã£ãŸã‚‰ã€Œã©ã†ã™ã‚Œã°ã„ã„ï¼Ÿã€ã¨èã„ã¦ãã ã•ã„

# æ—¢ã«ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—æ¸ˆã¿ã§æœ€æ–°ã®å ´åˆ
on_skip:
  message: |
    âœ… **æœ€æ–°ãƒãƒ¼ã‚¸ãƒ§ãƒ³ (v{{plugin_version}}) ãŒã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—æ¸ˆã¿ã§ã™**

    æ—¢å­˜ã®è¨­å®šã‚’ä¸Šæ›¸ãã™ã‚‹å ´åˆã¯ã€Œä¸Šæ›¸ãã—ã¦ã€ã¨è¨€ã£ã¦ãã ã•ã„ã€‚

# æ›´æ–°ãŒå¿…è¦ãªå ´åˆ
on_update:
  message: |
    âš ï¸ **ãƒ—ãƒ©ã‚°ã‚¤ãƒ³ãŒæ›´æ–°ã•ã‚Œã¦ã„ã¾ã™**

    ç¾åœ¨: v{{current_version}} â†’ æœ€æ–°: v{{plugin_version}}

    æ›´æ–°ã‚’é©ç”¨ã—ã¾ã™ã‹ï¼Ÿ (y/n)

# ã‚¨ãƒ©ãƒ¼æ™‚ã®å‡ºåŠ›
on_error:
  message: |
    âš ï¸ **ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—ä¸­ã«ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ**

    è©³ç´°ã‚’ç¢ºèªã—ã¦ã€ã€Œã‚‚ã†ä¸€åº¦ã€ã¨è¨€ã£ã¦ãã ã•ã„ã€‚

    ã‚ˆãã‚ã‚‹å•é¡Œ:
    - ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆãƒ•ã‚¡ã‚¤ãƒ«ãŒè¦‹ã¤ã‹ã‚‰ãªã„ â†’ ãƒ—ãƒ©ã‚°ã‚¤ãƒ³ã‚’å†ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«
    - æ›¸ãè¾¼ã¿æ¨©é™ãŒãªã„ â†’ ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã®æ¨©é™ã‚’ç¢ºèª
