# /setup-2agent ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼å®šç¾©
# 2ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆä½“åˆ¶ï¼ˆCursor PM + Claude Code Workerï¼‰ã®ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—

phase: setup-2agent
description: "2ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆä½“åˆ¶ã«å¿…è¦ãªãƒ•ã‚¡ã‚¤ãƒ«ã‚’ç”Ÿæˆãƒ»é…ç½®ã™ã‚‹"

steps:
  # Step 1: ç¾åœ¨ã®çŠ¶æ…‹ã‚’ç¢ºèª
  - id: check-setup-status
    skill: ccp-core-read-repo-context
    input:
      files:
        - .cursor-cc-version
        - AGENTS.md
        - CLAUDE.md
        - Plans.md
        - .cursor/commands/handoff-to-claude.md
        - .cursor/commands/review-cc-work.md
      context_from:
        - repo_tree
        - plugin_version
    output:
      variables:
        - setup_status  # new | current | outdated
        - existing_files
        - plugin_version
    mode: required

  # Step 2: ãƒãƒ¼ã‚¸ãƒ§ãƒ³æ¯”è¼ƒã¨ç¢ºèª
  - id: version-check
    skill: ccp-setup-2agent-files
    input:
      files:
        - .cursor-cc-version
      variables:
        - setup_status
        - plugin_version
    output:
      variables:
        - should_proceed
        - update_type  # new | update | skip
        - current_version  # æ—¢å­˜ã®ãƒãƒ¼ã‚¸ãƒ§ãƒ³ï¼ˆæ›´æ–°æ™‚ã®ã¿ï¼‰
    mode: required

  # Step 3: ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼ãƒ•ã‚¡ã‚¤ãƒ«ç”Ÿæˆ (AGENTS.md, CLAUDE.md, Plans.md)
  - id: generate-workflow-files
    skill: ccp-generate-workflow-files
    condition: "should_proceed"
    input:
      templates:
        - templates/AGENTS.md.template
        - templates/CLAUDE.md.template
        - templates/Plans.md.template
      variables:
        - project_name
        - date
    output:
      create_files:
        - AGENTS.md
        - CLAUDE.md
        - Plans.md
    mode: required

  # Step 4: Cursorã‚³ãƒãƒ³ãƒ‰ãƒ»ãƒ¡ãƒ¢ãƒªæ§‹é€ ãƒ»ãƒãƒ¼ã‚¸ãƒ§ãƒ³ãƒ•ã‚¡ã‚¤ãƒ«ã®é…ç½®
  - id: setup-2agent-files
    skill: ccp-setup-2agent-files
    condition: "should_proceed"
    input:
      templates:
        # Cursor ã‚³ãƒãƒ³ãƒ‰ï¼ˆ5ãƒ•ã‚¡ã‚¤ãƒ«ï¼‰
        - templates/cursor/commands/start-session.md
        - templates/cursor/commands/project-overview.md
        - templates/cursor/commands/plan-with-cc.md
        - templates/cursor/commands/handoff-to-claude.md
        - templates/cursor/commands/review-cc-work.md
        # ãã®ä»–
        - templates/.cursor-cc-version.template
      variables:
        - plugin_version
        - date
        - project_name
    output:
      create_files:
        # Cursor ã‚³ãƒãƒ³ãƒ‰
        - .cursor/commands/start-session.md
        - .cursor/commands/project-overview.md
        - .cursor/commands/plan-with-cc.md
        - .cursor/commands/handoff-to-claude.md
        - .cursor/commands/review-cc-work.md
        # ãƒ¡ãƒ¢ãƒª
        - .claude/memory/session-log.md
        - .claude/memory/decisions.md
        - .claude/memory/patterns.md
        # ãƒãƒ¼ã‚¸ãƒ§ãƒ³
        - .cursor-cc-version
    mode: required

  # Step 5: Hooks è¨­å®šã®é…ç½®ï¼ˆè‡ªå‹•æ•´ç†æ©Ÿèƒ½ï¼‰
  - id: setup-hooks
    skill: ccp-setup-2agent-files
    condition: "should_proceed"
    input:
      templates:
        - templates/hooks/auto-cleanup-hook.sh
        - templates/.cursor-cc-config.yaml.template
      variables:
        - plugin_version
    output:
      create_files:
        - .claude/scripts/auto-cleanup-hook.sh
        - .cursor-cc-config.yaml
      configure:
        - .claude/settings.json  # Hooks è¨­å®šã‚’è¿½åŠ 
    mode: optional

# æˆåŠŸæ™‚ã®å‡ºåŠ›
on_success:
  message: |
    âœ… **2ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆä½“åˆ¶ã®ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—ãŒå®Œäº†ã—ã¾ã—ãŸï¼** (v{{plugin_version}})

    ğŸ“ **ç”Ÿæˆã•ã‚ŒãŸãƒ•ã‚¡ã‚¤ãƒ«**:
    ```
    ./
    â”œâ”€â”€ AGENTS.md              # é–‹ç™ºãƒ•ãƒ­ãƒ¼æ¦‚è¦
    â”œâ”€â”€ CLAUDE.md              # Claude Code å°‚ç”¨è¨­å®š
    â”œâ”€â”€ Plans.md               # ã‚¿ã‚¹ã‚¯ç®¡ç†ï¼ˆå…±æœ‰ï¼‰
    â”œâ”€â”€ .cursor-cc-version     # ãƒãƒ¼ã‚¸ãƒ§ãƒ³ç®¡ç†
    â”œâ”€â”€ .cursor-cc-config.yaml # è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«ï¼ˆã‚«ã‚¹ã‚¿ãƒã‚¤ã‚ºå¯ï¼‰
    â”œâ”€â”€ .cursor/
    â”‚   â””â”€â”€ commands/          # Cursor ç”¨ã‚³ãƒãƒ³ãƒ‰ (5å€‹)
    â”‚       â”œâ”€â”€ start-session.md     # ã‚»ãƒƒã‚·ãƒ§ãƒ³é–‹å§‹
    â”‚       â”œâ”€â”€ project-overview.md  # ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆç¢ºèª
    â”‚       â”œâ”€â”€ plan-with-cc.md      # è¨ˆç”»ç«‹æ¡ˆ
    â”‚       â”œâ”€â”€ handoff-to-claude.md      # ã‚¿ã‚¹ã‚¯ä¾é ¼
    â”‚       â””â”€â”€ review-cc-work.md    # å®Œäº†ãƒ¬ãƒ“ãƒ¥ãƒ¼
    â””â”€â”€ .claude/
        â”œâ”€â”€ memory/            # ã‚»ãƒƒã‚·ãƒ§ãƒ³è¨˜éŒ²
        â”œâ”€â”€ scripts/           # è‡ªå‹•åŒ–ã‚¹ã‚¯ãƒªãƒ—ãƒˆ
        â”‚   â””â”€â”€ auto-cleanup-hook.sh
        â””â”€â”€ settings.json      # Hooks è¨­å®š
    ```

    ---

    ğŸ¯ **Cursor (PM) ã§ä½¿ãˆã‚‹ã‚³ãƒãƒ³ãƒ‰**:

    | ã‚³ãƒãƒ³ãƒ‰ | ç”¨é€” | ã„ã¤ä½¿ã† |
    |---------|------|---------|
    | `/start-session` | ã‚»ãƒƒã‚·ãƒ§ãƒ³é–‹å§‹ | ä½œæ¥­ã‚’å§‹ã‚ã‚‹æ™‚ |
    | `/project-overview` | å…¨ä½“ç¢ºèª | çŠ¶æ³ã‚’æŠŠæ¡ã—ãŸã„æ™‚ |
    | `/plan-with-cc` | è¨ˆç”»ç«‹æ¡ˆ | ä½•ã‚’ã™ã¹ãã‹ç›¸è«‡ã—ãŸã„æ™‚ |
    | `/handoff-to-claude` | ã‚¿ã‚¹ã‚¯ä¾é ¼ | å…·ä½“çš„ãªä½œæ¥­ã‚’ä¾é ¼ã™ã‚‹æ™‚ |
    | `/review-cc-work` | å®Œäº†ãƒ¬ãƒ“ãƒ¥ãƒ¼ | ä½œæ¥­çµæœã‚’ç¢ºèªã™ã‚‹æ™‚ |

    ---

    ğŸ”§ **Claude Code (Worker) ã§ä½¿ãˆã‚‹ã‚³ãƒãƒ³ãƒ‰**:

    | ã‚³ãƒãƒ³ãƒ‰ | ç”¨é€” |
    |---------|------|
    | `/start-task` | ã‚¿ã‚¹ã‚¯é–‹å§‹ |
    | `/handoff-to-cursor` | å®Œäº†å ±å‘Š |
    | `/sync-status` | çŠ¶æ…‹ç¢ºèª |
    | `/cleanup` | ãƒ•ã‚¡ã‚¤ãƒ«æ•´ç† |

    ---

    ğŸ§¹ **è‡ªå‹•æ•´ç†æ©Ÿèƒ½ï¼ˆNEWï¼‰**:

    Plans.md ç­‰ã¸ã®æ›¸ãè¾¼ã¿æ™‚ã«è‡ªå‹•ã§ã‚µã‚¤ã‚ºã‚’ãƒã‚§ãƒƒã‚¯ã€‚
    é–¾å€¤ã‚’è¶…ãˆãŸå ´åˆã¯æ•´ç†ã‚’ææ¡ˆã—ã¾ã™ã€‚

    | è¨­å®š | ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆ |
    |------|-----------|
    | Plans.md æœ€å¤§è¡Œæ•° | 200è¡Œ |
    | ã‚¢ãƒ¼ã‚«ã‚¤ãƒ–ç§»å‹• | å®Œäº†ã‹ã‚‰7æ—¥å¾Œ |

    è¨­å®šå¤‰æ›´: `.cursor-cc-config.yaml` ã‚’ç·¨é›†

    ---

    ğŸš€ **æœ€åˆã®ä¸€æ­©**:

    **Cursor** ã§ `/start-session` ã‚’å®Ÿè¡Œã—ã¦ã€ä»Šæ—¥ã‚„ã‚ŠãŸã„ã“ã¨ã‚’ä¼ãˆã¦ãã ã•ã„ã€‚

    ğŸ’¡ å›°ã£ãŸã‚‰ã€Œã©ã†ã™ã‚Œã°ã„ã„ï¼Ÿã€ã¨èã„ã¦ãã ã•ã„

# æ—¢ã«ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—æ¸ˆã¿ã§æœ€æ–°ã®å ´åˆ
on_skip:
  message: |
    âœ… **æœ€æ–°ãƒãƒ¼ã‚¸ãƒ§ãƒ³ (v{{plugin_version}}) ãŒã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—æ¸ˆã¿ã§ã™**

    æ—¢å­˜ã®è¨­å®šã‚’ä¸Šæ›¸ãã™ã‚‹å ´åˆã¯ã€Œä¸Šæ›¸ãã—ã¦ã€ã¨è¨€ã£ã¦ãã ã•ã„ã€‚

# æ›´æ–°ãŒå¿…è¦ãªå ´åˆ
on_update:
  message: |
    âš ï¸ **ãƒ—ãƒ©ã‚°ã‚¤ãƒ³ãŒæ›´æ–°ã•ã‚Œã¦ã„ã¾ã™**

    ç¾åœ¨: v{{current_version}} â†’ æœ€æ–°: v{{plugin_version}}

    æ›´æ–°ã‚’é©ç”¨ã—ã¾ã™ã‹ï¼Ÿ (y/n)

# ã‚¨ãƒ©ãƒ¼æ™‚ã®å‡ºåŠ›
on_error:
  message: |
    âš ï¸ **ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—ä¸­ã«ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ**

    è©³ç´°ã‚’ç¢ºèªã—ã¦ã€ã€Œã‚‚ã†ä¸€åº¦ã€ã¨è¨€ã£ã¦ãã ã•ã„ã€‚

    ã‚ˆãã‚ã‚‹å•é¡Œ:
    - ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆãƒ•ã‚¡ã‚¤ãƒ«ãŒè¦‹ã¤ã‹ã‚‰ãªã„ â†’ ãƒ—ãƒ©ã‚°ã‚¤ãƒ³ã‚’å†ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«
    - æ›¸ãè¾¼ã¿æ¨©é™ãŒãªã„ â†’ ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã®æ¨©é™ã‚’ç¢ºèª
