name: validate-plugin

on:
  pull_request:
  push:
    branches:
      - main

permissions:
  contents: read

jobs:
  validate:
    runs-on: ubuntu-latest
    timeout-minutes: 10

    steps:
      - name: Checkout
        uses: actions/checkout@v4
        with:
          fetch-depth: 0

      - name: Check version bump (warn)
        id: version_bump
        continue-on-error: true
        run: |
          bash ./scripts/ci/check-version-bump.sh

      - name: Version bump missing (fail)
        if: steps.version_bump.outcome == 'failure'
        run: |
          echo "::warning title=Version bump missing::Code changes detected but VERSION was not bumped. Please bump version before merging."
          exit 1

      - name: Validate plugin structure
        run: |
          bash ./tests/validate-plugin.sh

      - name: Check consistency (templates/refs/version/hooks)
        run: |
          bash ./scripts/ci/check-consistency.sh


