# 改善されたベンチマーク設計 v2

## 研究に基づく改善点

| 問題 | 改善策 |
|------|--------|
| Skill/Task 発動未確認 | `--output-format stream-json`（推奨）で tool_use を記録し、`"name":"Task"` / `"subagent_type"` を検出する（Skillは model-invoked のため tool_use では直接観測できない。ロード/エラーは `claude --debug` を併用） |
| 単一実行 | 各テストを3回実行、平均と標準偏差を計算 |
| タスク完了率のみ | 行動変化（ファイル変更、ツール種類）を測定 |
| 人工的タスク | より実践的なタスク設計 |

## 測定指標

### 1. 主要指標（Primary Metrics）

| 指標 | 測定方法 |
|------|---------|
| **ツール呼び出し種類** | `stream-json` から `"type":"tool_use"` を抽出 |
| **Task tool 検出** | `stream-json` から `"name":"Task"` / `"subagent_type"` をカウント |
| **実行時間** | 開始〜終了の経過時間 |
| **出力長** | 文字数 |

### 2. 行動指標（Behavioral Metrics）

| 指標 | 測定方法 |
|------|---------|
| **Read tool 回数** | ファイル読み込み回数 |
| **構造化出力** | テーブル/リスト形式の有無 |
| **OWASP/CWE引用** | セキュリティ標準の引用 |

## テストケース

### Test 1: セキュリティレビュー（基本）
```
プロンプト: "auth-handler.ts のセキュリティ問題を3点指摘して"
期待: セキュリティ問題の特定
```

### Test 2: 並列レビュー（複合）
```
プロンプト: "auth-handler.ts をセキュリティ・品質・パフォーマンスの3観点でレビュー"
期待: 3観点の分離された出力
```

### Test 3: 実装タスク
```
プロンプト: "入力バリデーション関数を設計して（実装不要、設計のみ）"
期待: 関数設計の提案
```

## 比較対象

1. **latest** (v2.4.1) - 21スキル
2. **v2.2.2** - 12スキル
3. **no-plugin** - プラグインなし

## 実行計画

各テスト × 3バージョン × 3回 = 27回実行
