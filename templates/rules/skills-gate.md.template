---
description: Skills Gate ルール - コード編集前にスキル使用を促す
paths: "**/*.{ts,tsx,js,jsx,py,rb,go,rs,java,kt,swift,c,cpp,h,hpp,cs,php}"
_harness_template: "rules/skills-gate.md.template"
_harness_version: "{{VERSION}}"
_harness_condition: "skills_gate.enabled"
---

# Skills Gate

このプロジェクトでは **Skills Gate** が有効です。

## 原則

**コード編集（Write/Edit）を行う前に、適切なスキルを使用してください。**

スキルは作業の品質を向上させるガイドラインを提供します。

---

## スキルを使うタイミング

| 作業 | スキル | 呼び出し方 |
|------|--------|-----------|
| 機能を実装する | `impl` | Skill ツールで「impl」を呼び出す |
| コードをレビューする | `review` | Skill ツールで「review」を呼び出す |
| UI を作成する | `ui` | Skill ツールで「ui」を呼び出す |
| 認証・決済を実装する | `auth` | Skill ツールで「auth」を呼び出す |
| デプロイ設定をする | `deploy` | Skill ツールで「deploy」を呼び出す |

---

## なぜスキルを使うのか

### 1. 品質の向上

スキルには、その作業に必要なチェックリストやベストプラクティスが含まれています。
見落としを防ぎ、一貫した品質を維持できます。

### 2. 効率的な作業

スキルは作業の標準フローを提供します。
何から始めるべきか、何を確認すべきかが明確になります。

### 3. 知識の蓄積

スキルを通じて、プロジェクト固有のパターンや決定事項にアクセスできます。

---

## 除外（スキル不要）

以下のファイルは Skills Gate の対象外です：

| パターン | 理由 |
|---------|------|
| `*.md`, `*.txt` | ドキュメント |
| `*.json` | 設定ファイル |
| `.claude/*` | ハーネス内部ファイル |
| `docs/*`, `templates/*` | ドキュメント・テンプレート |

---

## 動作の仕組み

```
コード編集を試みる
    ↓
このセッションでスキルを使った？
    ├── YES → 通過（編集可能）
    └── NO  → ブロック（スキル使用を促す）
```

- **1回でもスキルを使えば**、そのセッション中は解除されます
- スキル使用は `session-skills-used.json` で追跡されます

---

## ブロックされた場合

スキルを使わずにコード編集しようとすると、以下のメッセージが表示されます：

```
[Skills Gate] コード編集前にスキルを使用してください。

利用可能なスキル: impl, review, ui, ...

例: Skill ツールで 'impl' や 'review' を呼び出す
```

この場合は、適切なスキルを Skill ツールで呼び出してから、再度編集を試みてください。

---

## スキルの選び方

### 迷ったら `impl` を使う

`impl` スキルは汎用的な実装ガイダンスを提供します。
何を使うべきか分からない場合は、まず `impl` を呼び出してください。

### 複数のスキルを使う

1つの作業で複数のスキルを使うこともできます。
例: UI コンポーネントを実装する場合 → `impl` + `ui`

---

## 設定の変更

Skills Gate の有効/無効は `.claude/state/skills-config.json` で管理されます。

```bash
# 無効化（非推奨）
/skills-update disable

# 有効化
/skills-update enable

# スキルの追加
/skills-update add auth
```

---

## Memory-Enhanced Skills（Claude-mem 統合時）

Claude-mem が有効な場合、スキルは過去の記憶を活用して品質を向上させます。

### 機能強化されるスキル

| スキル | 強化内容 |
|--------|---------|
| `impl` | 過去の実装パターン・gotcha を自動参照 |
| `review` | 過去の類似レビュー指摘を参照 |
| `verify` | 過去のビルドエラー解決策を参照 |
| `session-init` | ガードレール発動履歴・作業サマリーを表示 |

### 活用例

```
# impl スキル使用時
📚 過去の関連パターン:
- API エンドポイント: RESTful 設計パターン採用
- エラーハンドリング: 統一例外ハンドラー使用

💡 過去の gotcha:
- CORS 設定: Allow-Origin ヘッダー必須
```

### Claude-mem なし環境

Claude-mem が未設定の場合、各スキルは通常通り動作します。
Memory-Enhanced 機能は自動的にスキップされます。

### セットアップ

```bash
# Claude-mem 統合を有効化
/harness-mem
```
