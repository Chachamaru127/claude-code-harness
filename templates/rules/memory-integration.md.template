---
description: Memory Integration ルール - Claude-mem との連携によるセッション跨ぎ品質強化
paths: "**"
_harness_template: "rules/memory-integration.md.template"
_harness_version: "{{VERSION}}"
_harness_condition: "claude_mem.enabled"
---

# Memory Integration

このプロジェクトでは **Claude-mem 統合**が有効です。

セッション跨ぎの品質・文脈維持機能により、過去の学習が活用されます。

---

## 機能概要

| 機能 | 説明 |
|------|------|
| 過去の記憶検索 | `mem-search` スキルで過去の作業履歴を検索 |
| ガードレール履歴 | 過去のテスト改ざん防止記録を参照 |
| 文脈継続 | 前回セッションの状態から即座に継続 |
| パターン学習 | 過去のバグ修正・設計決定を再利用 |

---

## スキルでの活用方法

### 1. セッション開始時（session-init）

セッション開始時に過去の文脈が自動表示されます：

```
🚀 セッション開始

📚 過去の文脈:
- 前回: Feature X の設計完了（RBAC採用）
- ガードレール発動: 過去2回テスト改ざんを防止

📋 継続タスク:
- Feature X 実装フェーズ
```

### 2. 実装時（impl スキル）

実装前に過去の関連パターンを自動検索：

```
# 例: API エンドポイント実装時
mem-search: "API endpoint pattern" "error handling"

# 過去の実装パターン、gotcha（落とし穴）が表示される
```

### 3. レビュー時（review スキル）

過去の類似レビュー指摘を参照：

```
# 例: 認証コードレビュー時
mem-search: "authentication review" "security"

# 過去に指摘した認証関連の問題パターンが表示される
```

### 4. 検証時（verify スキル）

過去のビルドエラー・解決策を参照：

```
# 例: ビルドエラー発生時
mem-search: "build error" "CORS" "解決"

# 過去の類似エラーと解決方法が表示される
```

---

## 記録される内容

### ハーネスモードで自動記録

| 観測タイプ | 説明 | 例 |
|-----------|------|-----|
| `plan` | Plans.md へのタスク追加・更新 | 「Feature X を3タスクに分割」 |
| `guard` | ガードレール発動 | 「it.skip() 追加をブロック」 |
| `decision` | 設計決定と理由 | 「RBAC 採用: スケーラビリティ重視」 |
| `bugfix` | バグ修正内容 | 「CORS エラー: Allow-Origin 追加」 |
| `handoff` | PM ↔ Impl 役割移行 | 「PM → Impl: 認証機能実装依頼」 |

### 観測コンセプト

| コンセプト | 検索キーワード例 |
|-----------|-----------------|
| `user-intent` | 「ユーザーが何を求めていたか」 |
| `gotcha` | 「落とし穴」「注意点」 |
| `pattern` | 「再利用パターン」 |
| `test-quality` | 「テスト改ざん」「品質」 |

---

## 手動検索

過去の記憶を手動で検索する場合：

```
# mem-search スキルを使用
Skill ツールで 'mem-search' を呼び出す

# 検索クエリ例
「認証の実装パターン」
「CORS エラー 解決」
「テスト改ざん 防止」
「前回のセッションで何をした？」
```

---

## ガードレール強化

過去のガードレール発動履歴が累積学習されます：

### 例: テスト改ざん防止

```
⚠️ このプロジェクトでは過去に以下を防止しました:

- 2024-01-15: it.skip() 追加を防止（支払いテスト）
- 2024-01-20: expect.toEqual() の緩和を防止

💡 テスト改ざんは禁止されています。
   実装を修正してテストを通してください。
```

---

## SSOT との連携

重要な観測は SSOT（decisions.md / patterns.md）に昇格できます：

```bash
# 重要な決定を SSOT に昇格
/sync-ssot-from-memory

# 昇格対象:
# - decision タイプの観測 → decisions.md
# - pattern コンセプトの観測 → patterns.md
```

---

## トークンコスト

Claude-mem 統合により、セッションあたり約 **+500〜1,000 トークン** の追加コストが発生します。

### コスト対効果

| 観点 | メリット |
|------|---------|
| ウォームスタート | コンテキスト再構築の手間削減（数千トークン節約） |
| 重複防止 | 同じ調査の繰り返し回避 |
| 品質累積 | 過去のミスを繰り返さない |

---

## 無効化

Claude-mem 統合を一時的に無効化する場合：

```bash
# settings.json を編集
# "CLAUDE_MEM_MODE": "code" に変更
```

---

## 関連

- `/harness-mem` - Claude-mem 統合セットアップ
- `mem-search` スキル - 過去の記憶検索
- `/sync-ssot-from-memory` - 観測の SSOT 昇格
