---
name: ccp-status-anomaly-detection
description: "タスク状態の異常（停滞・競合）を検知するスキル"
metadata:
  skillport:
    category: pm
    tags: [status, anomaly, detection, warning]
    alwaysApply: false
---

# Status Anomaly Detection

タスク状態の異常を検知し、警告を生成するスキル。

---

## 目的

以下の異常を検知して早期に対処：
- 長期間停滞しているタスク
- 複数の WIP タスク（同時進行の問題）
- ブロック中タスクの放置
- マーカーの不整合

---

## 入力

| 項目 | 説明 |
|------|------|
| `tasks_wip` | 作業中タスク |
| `tasks_blocked` | ブロック中タスク |

---

## 出力

| 項目 | 説明 |
|------|------|
| `warnings` | 検知された警告のリスト |

---

## 検知パターン

### 1. 複数 WIP タスク

**条件**: `cc:WIP` が 2 件以上

**警告**:
```markdown
⚠️ **複数のタスクが同時進行中**

現在 {{count}} 件のタスクが WIP 状態です：
1. {{task_1}}
2. {{task_2}}

**推奨**: 1 つのタスクに集中することを推奨します。
```

### 2. 長期停滞タスク

**条件**: WIP 状態が 24 時間以上継続

**警告**:
```markdown
⚠️ **タスクが停滞している可能性**

「{{task_name}}」が 24 時間以上 WIP 状態です。

**確認事項**:
- [ ] 問題が発生していないか
- [ ] 作業が完了しているか（マーカー更新忘れ）
- [ ] 支援が必要か
```

### 3. ブロック放置

**条件**: ブロック中タスクが 48 時間以上

**警告**:
```markdown
⚠️ **ブロック中タスクが放置されています**

「{{task_name}}」が {{hours}} 時間ブロック中です。

**ブロック理由**: {{block_reason}}

**推奨アクション**:
- Cursor (PM) にエスカレーション
- 代替アプローチの検討
```

### 4. マーカー不整合

**条件**: 認識できないマーカー、または矛盾するマーカー

**警告**:
```markdown
⚠️ **マーカーの不整合**

「{{task_name}}」に不正なマーカーがあります：
- 現在のマーカー: {{marker}}
- 問題: {{issue}}

**推奨**: マーカーを修正してください。
```

### 5. 完了なしの長期進行

**条件**: 7 日以上完了タスクがない

**警告**:
```markdown
⚠️ **進捗が停滞している可能性**

過去 7 日間で完了したタスクがありません。

**確認事項**:
- [ ] タスクの粒度が大きすぎないか
- [ ] 問題が発生していないか
```

---

## 警告レベル

| レベル | 表示 | 対応 |
|--------|------|------|
| info | ℹ️ | 参考情報 |
| warning | ⚠️ | 確認を推奨 |
| error | ❌ | 即時対応が必要 |

---

## 出力例

```yaml
warnings:
  - level: warning
    type: multiple_wip
    message: "2 件のタスクが同時進行中"
    tasks:
      - "ユーザー認証機能"
      - "検索機能"
    recommendation: "1 つのタスクに集中することを推奨"

  - level: warning
    type: blocked_long
    message: "ブロック中タスクが 72 時間経過"
    task: "外部API連携"
    block_reason: "API仕様待ち"
    recommendation: "PM にエスカレーション"
```

---

## 注意事項

- 警告は情報提供であり、強制ではない
- 正当な理由で複数 WIP の場合もある
- タイムスタンプがない場合は検知できない
